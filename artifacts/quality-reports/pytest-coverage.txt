============================= test session starts ==============================
platform linux -- Python 3.13.5, pytest-8.4.1, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.5/x64/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/work/travelstyle/travelstyle/backend
configfile: pytest.ini
plugins: cov-6.2.1, asyncio-1.1.0, xdist-3.8.0, anyio-4.9.0, mock-3.14.1
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 393 items

tests/test_auth.py::TestAuthRegistrationAndLogin::test_register_success PASSED [  0%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_register_invalid_email PASSED [  0%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_register_short_password PASSED [  0%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_register_service_error PASSED [  1%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_register_service_exception PASSED [  1%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_login_success PASSED [  1%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_login_invalid_credentials PASSED [  1%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_login_invalid_email PASSED [  2%]
tests/test_auth.py::TestAuthRegistrationAndLogin::test_login_service_exception PASSED [  2%]
tests/test_auth.py::TestAuthOtherEndpoints::test_logout_success PASSED   [  2%]
tests/test_auth.py::TestAuthOtherEndpoints::test_logout_without_token PASSED [  2%]
tests/test_auth.py::TestAuthOtherEndpoints::test_logout_unauthorized PASSED [  3%]
tests/test_auth.py::TestAuthOtherEndpoints::test_logout_service_exception PASSED [  3%]
tests/test_auth.py::TestAuthOtherEndpoints::test_forgot_password_success PASSED [  3%]
tests/test_auth.py::TestAuthOtherEndpoints::test_forgot_password_invalid_email PASSED [  3%]
tests/test_auth.py::TestAuthOtherEndpoints::test_forgot_password_service_exception PASSED [  4%]
tests/test_auth.py::TestAuthOtherEndpoints::test_reset_password_success PASSED [  4%]
tests/test_auth.py::TestAuthOtherEndpoints::test_reset_password_invalid_token PASSED [  4%]
tests/test_auth.py::TestAuthOtherEndpoints::test_reset_password_short_password PASSED [  4%]
tests/test_auth.py::TestAuthOtherEndpoints::test_reset_password_service_exception PASSED [  5%]
tests/test_auth.py::TestAuthOtherEndpoints::test_refresh_token_success PASSED [  5%]
tests/test_auth.py::TestAuthOtherEndpoints::test_refresh_token_invalid PASSED [  5%]
tests/test_auth.py::TestAuthOtherEndpoints::test_refresh_token_service_exception PASSED [  5%]
tests/test_auth.py::TestAuthOtherEndpoints::test_get_current_user_profile_success PASSED [  6%]
tests/test_auth.py::TestAuthOtherEndpoints::test_get_current_user_profile_not_found PASSED [  6%]
tests/test_auth.py::TestAuthOtherEndpoints::test_get_current_user_profile_unauthorized PASSED [  6%]
tests/test_auth.py::TestAuthOtherEndpoints::test_get_current_user_profile_service_exception PASSED [  6%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_profile_success PASSED [  7%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_profile_no_valid_fields PASSED [  7%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_profile_not_found PASSED [  7%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_profile_unauthorized PASSED [  7%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_profile_service_exception PASSED [  8%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_preferences_success PASSED [  8%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_preferences_no_valid_fields PASSED [  8%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_preferences_unauthorized PASSED [  8%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_preferences_service_failure PASSED [  9%]
tests/test_auth.py::TestAuthOtherEndpoints::test_update_current_user_preferences_service_exception PASSED [  9%]
tests/test_auth_service.py::test_login_success PASSED                    [  9%]
tests/test_auth_service.py::test_login_invalid_credentials PASSED        [  9%]
tests/test_auth_service.py::test_login_no_session PASSED                 [ 10%]
tests/test_auth_service.py::test_login_exception PASSED                  [ 10%]
tests/test_auth_service.py::test_logout_success PASSED                   [ 10%]
tests/test_auth_service.py::test_logout_with_refresh_token PASSED        [ 10%]
tests/test_auth_service.py::test_logout_exception PASSED                 [ 11%]
tests/test_auth_service.py::test_forgot_password_success PASSED          [ 11%]
tests/test_auth_service.py::test_forgot_password_exception_original PASSED [ 11%]
tests/test_auth_service.py::test_reset_password_success PASSED           [ 11%]
tests/test_auth_service.py::test_reset_password_exception_original PASSED [ 12%]
tests/test_auth_service.py::test_refresh_token_success PASSED            [ 12%]
tests/test_auth_service.py::test_refresh_token_no_session_original PASSED [ 12%]
tests/test_auth_service.py::test_register_success PASSED                 [ 12%]
tests/test_auth_service.py::test_register_no_session PASSED              [ 13%]
tests/test_auth_service.py::test_get_user_profile_success PASSED         [ 13%]
tests/test_auth_service.py::test_update_user_profile_success PASSED      [ 13%]
tests/test_auth_service.py::test_update_user_profile_sync_success PASSED [ 13%]
tests/test_auth_service.py::test_update_user_profile_sync_no_user PASSED [ 14%]
tests/test_auth_service.py::test_update_user_preferences_success PASSED  [ 14%]
tests/test_auth_service.py::test_auth_service_init_client_failure PASSED [ 14%]
tests/test_auth_service.py::test_login_no_user_profile PASSED            [ 15%]
tests/test_auth_service.py::test_logout_with_refresh_token_exception PASSED [ 15%]
tests/test_auth_service.py::test_logout_without_refresh_token_exception PASSED [ 15%]
tests/test_auth_service.py::test_forgot_password_exception PASSED        [ 15%]
tests/test_auth_service.py::test_reset_password_exception PASSED         [ 16%]
tests/test_auth_service.py::test_refresh_token_no_session PASSED         [ 16%]
tests/test_auth_service.py::test_refresh_token_exception PASSED          [ 16%]
tests/test_auth_service.py::test_register_no_user PASSED                 [ 16%]
tests/test_auth_service.py::test_register_no_session_after_login PASSED  [ 17%]
tests/test_auth_service.py::test_register_exception PASSED               [ 17%]
tests/test_auth_service.py::test_get_user_profile_no_user PASSED         [ 17%]
tests/test_auth_service.py::test_get_user_profile_exception PASSED       [ 17%]
tests/test_auth_service.py::test_update_user_profile_no_user PASSED      [ 18%]
tests/test_auth_service.py::test_update_user_profile_exception PASSED    [ 18%]
tests/test_auth_service.py::test_update_user_profile_sync_no_auth_user PASSED [ 18%]
tests/test_auth_service.py::test_update_user_profile_sync_with_style_preferences PASSED [ 18%]
tests/test_auth_service.py::test_update_user_profile_sync_exception PASSED [ 19%]
tests/test_auth_service.py::test_update_user_preferences_exception PASSED [ 19%]
tests/test_auth_service.py::test_auth_service_no_client PASSED           [ 19%]
tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_success PASSED [ 19%]
tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_no_auth PASSED [ 20%]
tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_invalid_request PASSED [ 20%]
tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_orchestrator_error PASSED [ 20%]
tests/test_chat.py::TestChatEndpoints::test_get_conversation_history_success PASSED [ 20%]
tests/test_chat.py::TestChatEndpoints::test_get_conversation_history_no_auth PASSED [ 21%]
tests/test_chat.py::TestChatEndpoints::test_get_conversation_history_error PASSED [ 21%]
tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_database_error PASSED [ 21%]
tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_user_profile_error PASSED [ 21%]
tests/test_chat.py::test_generate_response_success PASSED                [ 22%]
tests/test_chat.py::test_generate_response_error PASSED                  [ 22%]
tests/test_chat.py::test_build_system_prompt PASSED                      [ 22%]
tests/test_chat.py::test_build_context_prompt PASSED                     [ 22%]
tests/test_chat.py::test_process_response PASSED                         [ 23%]
tests/test_chat_convs.py::test_get_user_conversations_success PASSED     [ 23%]
tests/test_chat_convs.py::test_get_user_conversations_no_auth PASSED     [ 23%]
tests/test_chat_convs.py::test_get_user_conversations_error PASSED       [ 23%]
tests/test_chat_convs.py::test_delete_conversation_success PASSED        [ 24%]
tests/test_chat_convs.py::test_delete_conversation_no_auth PASSED        [ 24%]
tests/test_chat_convs.py::test_delete_conversation_error PASSED          [ 24%]
tests/test_chat_convs.py::test_archive_conversation_success PASSED       [ 24%]
tests/test_chat_convs.py::test_archive_conversation_no_auth PASSED       [ 25%]
tests/test_chat_convs.py::test_archive_conversation_error PASSED         [ 25%]
tests/test_chat_feedback.py::test_save_feedback_success PASSED           [ 25%]
tests/test_chat_feedback.py::test_save_feedback_no_auth PASSED           [ 25%]
tests/test_chat_feedback.py::test_save_feedback_error PASSED             [ 26%]
tests/test_chat_feedback.py::test_save_feedback_invalid PASSED           [ 26%]
tests/test_chat_sessions.py::test_create_session_success PASSED          [ 26%]
tests/test_chat_sessions.py::test_create_session_no_auth PASSED          [ 26%]
tests/test_chat_sessions.py::test_create_session_error PASSED            [ 27%]
tests/test_chat_sessions.py::test_create_session_invalid PASSED          [ 27%]
tests/test_currency_api.py::TestConvertCurrency::test_convert_currency_success_with_amount PASSED [ 27%]
tests/test_currency_api.py::TestConvertCurrency::test_convert_currency_success_without_amount PASSED [ 27%]
tests/test_currency_api.py::TestConvertCurrency::test_convert_currency_error_response PASSED [ 28%]
tests/test_currency_api.py::TestConvertCurrency::test_convert_currency_missing_message PASSED [ 28%]
tests/test_currency_api.py::TestConvertCurrency::test_convert_currency_empty_message PASSED [ 28%]
tests/test_currency_api.py::TestConvertCurrency::test_convert_currency_service_exception PASSED [ 29%]
tests/test_currency_api.py::TestGetSupportedCurrencies::test_get_supported_currencies_success PASSED [ 29%]
tests/test_currency_api.py::TestGetSupportedCurrencies::test_get_supported_currencies_service_exception PASSED [ 29%]
tests/test_currency_api.py::TestValidateCurrencyCode::test_validate_currency_code_valid PASSED [ 29%]
tests/test_currency_api.py::TestValidateCurrencyCode::test_validate_currency_code_invalid PASSED [ 30%]
tests/test_currency_api.py::TestValidateCurrencyCode::test_validate_currency_code_lowercase PASSED [ 30%]
tests/test_currency_api.py::TestValidateCurrencyCode::test_validate_currency_code_missing PASSED [ 30%]
tests/test_currency_api.py::TestValidateCurrencyCode::test_validate_currency_code_empty PASSED [ 30%]
tests/test_currency_api.py::TestValidateCurrencyCode::test_validate_currency_code_service_exception PASSED [ 31%]
tests/test_currency_api.py::TestParseCurrencyMessage::test_parse_currency_message_success PASSED [ 31%]
tests/test_currency_api.py::TestParseCurrencyMessage::test_parse_currency_message_invalid_currencies PASSED [ 31%]
tests/test_currency_api.py::TestParseCurrencyMessage::test_parse_currency_message_missing_currencies PASSED [ 31%]
tests/test_currency_api.py::TestParseCurrencyMessage::test_parse_currency_message_missing_message PASSED [ 32%]
tests/test_currency_api.py::TestParseCurrencyMessage::test_parse_currency_message_empty_message PASSED [ 32%]
tests/test_currency_api.py::TestParseCurrencyMessage::test_parse_currency_message_service_exception PASSED [ 32%]
tests/test_currency_api.py::TestCurrencyAPIIntegration::test_convert_currency_integration_with_real_service PASSED [ 32%]
tests/test_currency_api.py::TestCurrencyAPIIntegration::test_validate_currency_code_integration PASSED [ 33%]
tests/test_currency_api.py::TestCurrencyAPIIntegration::test_get_supported_currencies_integration PASSED [ 33%]
tests/test_currency_api.py::TestCurrencyAPIErrorHandling::test_convert_currency_network_error PASSED [ 33%]
tests/test_currency_api.py::TestCurrencyAPIErrorHandling::test_convert_currency_timeout_error PASSED [ 33%]
tests/test_currency_api.py::TestCurrencyAPIErrorHandling::test_validate_currency_code_with_special_characters PASSED [ 34%]
tests/test_currency_api.py::TestCurrencyAPIErrorHandling::test_parse_currency_message_with_complex_input PASSED [ 34%]
tests/test_currency_conversion_service.py::test_is_currency_request_true PASSED [ 34%]
tests/test_currency_conversion_service.py::test_is_currency_request_false PASSED [ 34%]
tests/test_currency_conversion_service.py::test_validate_currency_code PASSED [ 35%]
tests/test_currency_conversion_service.py::test_format_currency_response PASSED [ 35%]
tests/test_currency_conversion_service.py::test_get_supported_currencies PASSED [ 35%]
tests/test_currency_conversion_service.py::test_parse_currency_request_invalid_json PASSED [ 35%]
tests/test_currency_conversion_service.py::test_handle_currency_request_missing_currencies PASSED [ 36%]
tests/test_currency_conversion_service.py::test_parse_currency_request_valid_json PASSED [ 36%]
tests/test_currency_conversion_service.py::test_parse_currency_request_json_decode_error PASSED [ 36%]
tests/test_currency_conversion_service.py::test_parse_currency_request_openai_exception PASSED [ 36%]
tests/test_currency_conversion_service.py::test_handle_currency_request_unsupported_from_currency PASSED [ 37%]
tests/test_currency_conversion_service.py::test_handle_currency_request_unsupported_to_currency PASSED [ 37%]
tests/test_currency_conversion_service.py::test_handle_currency_request_no_exchange_rate PASSED [ 37%]
tests/test_currency_conversion_service.py::test_handle_currency_request_with_amount PASSED [ 37%]
tests/test_currency_conversion_service.py::test_handle_currency_request_without_amount PASSED [ 38%]
tests/test_currency_conversion_service.py::test_handle_currency_request_exception PASSED [ 38%]
tests/test_currency_conversion_service.py::test_parse_currency_request_with_whitespace PASSED [ 38%]
tests/test_currency_conversion_service.py::test_parse_currency_request_with_missing_amount PASSED [ 38%]
tests/test_currency_conversion_service.py::test_parse_currency_request_with_formatted_json PASSED [ 39%]
tests/test_currency_conversion_service.py::test_parse_currency_request_with_extra_text PASSED [ 39%]
tests/test_currency_conversion_service.py::test_parse_currency_request_with_amount_zero PASSED [ 39%]
tests/test_currency_conversion_service.py::test_parse_currency_request_with_negative_amount PASSED [ 39%]
tests/test_currency_service.py::test_get_exchange_rates_json_parse_error PASSED [ 40%]
tests/test_currency_service.py::test_get_exchange_rates_json_parse_exception PASSED [ 40%]
tests/test_currency_service.py::test_get_exchange_rates_non_dict_response PASSED [ 40%]
tests/test_currency_service.py::test_get_exchange_rates_http_status_error PASSED [ 40%]
tests/test_currency_service.py::test_get_exchange_rates_timeout_error PASSED [ 41%]
tests/test_currency_service.py::test_get_exchange_rates_value_error PASSED [ 41%]
tests/test_currency_service.py::test_get_exchange_rates_currency_normalization PASSED [ 41%]
tests/test_currency_service.py::test_get_pair_exchange_rate_json_parse_error PASSED [ 41%]
tests/test_currency_service.py::test_get_pair_exchange_rate_json_parse_exception PASSED [ 42%]
tests/test_currency_service.py::test_get_pair_exchange_rate_non_success_result PASSED [ 42%]
tests/test_currency_service.py::test_get_pair_exchange_rate_non_dict_response PASSED [ 42%]
tests/test_currency_service.py::test_get_pair_exchange_rate_currency_normalization PASSED [ 43%]
tests/test_currency_service.py::test_get_pair_exchange_rate_http_error PASSED [ 43%]
tests/test_currency_service.py::test_get_pair_exchange_rate_request_error PASSED [ 43%]
tests/test_currency_service.py::test_get_pair_exchange_rate_generic_exception PASSED [ 43%]
tests/test_currency_service.py::test_convert_currency_with_get_pair_exchange_rate_failure PASSED [ 44%]
tests/test_currency_service.py::test_convert_currency_amount_rounding PASSED [ 44%]
tests/test_currency_service.py::test_convert_currency_zero_amount PASSED [ 44%]
tests/test_currency_service.py::test_convert_currency_negative_amount PASSED [ 44%]
tests/test_currency_service.py::test_currency_service_initialization PASSED [ 45%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_get_conversation_history_with_conversation_id PASSED [ 45%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_get_conversation_history_without_conversation_id PASSED [ 45%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_get_conversation_history_error_handling PASSED [ 45%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_get_user_profile_with_preferences_and_destinations PASSED [ 46%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_conversation_message_with_existing_conversation PASSED [ 46%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_conversation_message_error_handling PASSED [ 46%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_update_user_preferences_update_existing PASSED [ 46%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_recommendation_feedback_success PASSED [ 47%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_recommendation_feedback_error PASSED [ 47%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_destination_new_destination PASSED [ 47%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_destination_existing_destination PASSED [ 47%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_destination_error PASSED [ 48%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_get_user_conversations_success PASSED [ 48%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_get_user_conversations_error PASSED [ 48%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_archive_conversation_success PASSED [ 48%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_archive_conversation_error PASSED [ 49%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_delete_conversation_success PASSED [ 49%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_delete_conversation_error PASSED [ 49%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_create_chat_session_success PASSED [ 49%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_create_chat_session_error PASSED [ 50%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_create_chat_session_empty_response PASSED [ 50%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_db_helpers_singleton_coverage PASSED [ 50%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_user_profile_success PASSED [ 50%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_user_profile_no_data_returned PASSED [ 51%]
tests/test_database_helpers_comprehensive.py::TestDatabaseHelpersComprehensive::test_save_user_profile_exception PASSED [ 51%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersSimple::test_database_helpers_class_basic PASSED [ 51%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersSimple::test_update_user_preferences_simple PASSED [ 51%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersSimple::test_save_conversation_message_simple PASSED [ 52%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersSimple::test_error_handling_simple PASSED [ 52%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersSimple::test_standalone_functions_bypass_autouse PASSED [ 52%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersSimple::test_imports_and_singleton PASSED [ 52%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersEdgeCases::test_get_user_profile_edge_cases PASSED [ 53%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersEdgeCases::test_save_conversation_message_edge_cases PASSED [ 53%]
tests/test_database_helpers_simple.py::TestDatabaseHelpersEdgeCases::test_create_chat_session_edge_cases PASSED [ 53%]
tests/test_deps.py::test_get_current_user_valid_token PASSED             [ 53%]
tests/test_deps.py::test_get_current_user_invalid_token PASSED           [ 54%]
tests/test_deps.py::test_get_current_user_exception PASSED               [ 54%]
tests/test_deps.py::test_get_current_user_missing_credentials PASSED     [ 54%]
tests/test_deps.py::test_get_current_active_user_active PASSED           [ 54%]
tests/test_deps.py::test_get_current_active_user_inactive PASSED         [ 55%]
tests/test_deps.py::test_get_current_active_user_missing_is_active PASSED [ 55%]
tests/test_deps.py::test_get_current_active_user_none_is_active PASSED   [ 55%]
tests/test_deps.py::test_get_current_user_empty_credentials PASSED       [ 55%]
tests/test_deps.py::test_get_current_user_none_credentials PASSED        [ 56%]
tests/test_main.py::test_root PASSED                                     [ 56%]
tests/test_main.py::test_health PASSED                                   [ 56%]
tests/test_main.py::test_docs PASSED                                     [ 56%]
tests/test_main.py::test_openapi PASSED                                  [ 57%]
tests/test_main.py::test_redoc PASSED                                    [ 57%]
tests/test_main.py::test_lifespan_startup_and_shutdown PASSED            [ 57%]
tests/test_main.py::test_main_block_exists PASSED                        [ 58%]
tests/test_orchestrator.py::test_generate_travel_recommendations_success PASSED [ 58%]
tests/test_orchestrator.py::test_generate_travel_recommendations_error PASSED [ 58%]
tests/test_orchestrator.py::test_parse_trip_context PASSED               [ 58%]
tests/test_orchestrator.py::test_enhance_response PASSED                 [ 59%]
tests/test_orchestrator.py::test_generate_travel_recommendations_orchestration_error PASSED [ 59%]
tests/test_orchestrator.py::test_safe_api_call_exception PASSED          [ 59%]
tests/test_orchestrator.py::test_parse_trip_context_destination_extraction PASSED [ 59%]
tests/test_orchestrator.py::test_parse_trip_context_destination_extraction_visiting PASSED [ 60%]
tests/test_orchestrator.py::test_parse_trip_context_destination_extraction_in PASSED [ 60%]
tests/test_orchestrator.py::test_parse_trip_context_business_context PASSED [ 60%]
tests/test_orchestrator.py::test_parse_trip_context_formal_context PASSED [ 60%]
tests/test_orchestrator.py::test_parse_trip_context_active_context PASSED [ 61%]
tests/test_orchestrator.py::test_enhance_response_with_all_context PASSED [ 61%]
tests/test_orchestrator.py::test_enhance_response_with_partial_context PASSED [ 61%]
tests/test_orchestrator.py::test_enhance_response_with_no_destination PASSED [ 61%]
tests/test_orchestrator.py::test_generate_travel_recommendations_no_destination PASSED [ 62%]
tests/test_orchestrator.py::test_generate_travel_recommendations_no_user_profile PASSED [ 62%]
tests/test_orchestrator.py::test_generate_travel_recommendations_currency_request_with_amount PASSED [ 62%]
tests/test_orchestrator.py::test_generate_travel_recommendations_currency_request_without_amount PASSED [ 62%]
tests/test_orchestrator.py::test_generate_travel_recommendations_currency_request_non_rate_type PASSED [ 63%]
tests/test_orchestrator.py::test_generate_travel_recommendations_exception_handling PASSED [ 63%]
tests/test_orchestrator.py::test_generate_travel_recommendations_exception_handling_alternative PASSED [ 63%]
tests/test_orchestrator.py::test_return_none_helper PASSED               [ 63%]
tests/test_rate_limiter.py::test_rate_limit_first_call PASSED            [ 64%]
tests/test_rate_limiter.py::test_rate_limit_within_limit PASSED          [ 64%]
tests/test_rate_limiter.py::test_rate_limit_exceeded PASSED              [ 64%]
tests/test_rate_limiter.py::test_rate_limit_reset_after_period PASSED    [ 64%]
tests/test_rate_limiter.py::test_rate_limit_with_jwt_token PASSED        [ 65%]
tests/test_rate_limiter.py::test_rate_limit_jwt_decode_failure PASSED    [ 65%]
tests/test_rate_limiter.py::test_rate_limit_no_request_object PASSED     [ 65%]
tests/test_rate_limiter.py::test_rate_limit_request_without_client PASSED [ 65%]
tests/test_rate_limiter.py::test_cleanup_old_entries PASSED              [ 66%]
tests/test_rate_limiter.py::test_cleanup_old_entries_no_cleanup_needed PASSED [ 66%]
tests/test_rate_limiter.py::test_rate_limit_cleanup_threshold PASSED     [ 66%]
tests/test_rate_limiter.py::test_rate_limit_jwt_missing_sub PASSED       [ 66%]
tests/test_rate_limiter.py::test_rate_limit_jwt_value_error PASSED       [ 67%]
tests/test_rate_limiter.py::test_rate_limit_jwt_key_error PASSED         [ 67%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_cultural_insights_success PASSED [ 67%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_cultural_insights_not_found PASSED [ 67%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_cultural_insights_service_exception PASSED [ 68%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_weather_forecast_success PASSED [ 68%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_weather_forecast_not_found PASSED [ 68%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_weather_forecast_service_exception PASSED [ 68%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_exchange_rates_success PASSED [ 69%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_exchange_rates_not_found PASSED [ 69%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_exchange_rates_service_exception PASSED [ 69%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_currency_conversion_success PASSED [ 69%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_currency_conversion_failure PASSED [ 70%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_currency_conversion_service_exception PASSED [ 70%]
tests/test_recommendations.py::TestRecommendationsEndpoints::test_recommendations_no_auth PASSED [ 70%]
tests/test_recommendations.py::test_get_exchange_rates_success PASSED    [ 70%]
tests/test_recommendations.py::test_get_exchange_rates_cache PASSED      [ 71%]
tests/test_recommendations.py::test_get_exchange_rates_error PASSED      [ 71%]
tests/test_recommendations.py::test_get_pair_exchange_rate_success PASSED [ 71%]
tests/test_recommendations.py::test_get_pair_exchange_rate_error PASSED  [ 72%]
tests/test_recommendations.py::test_get_pair_exchange_rate_endpoint_success PASSED [ 72%]
tests/test_recommendations.py::test_get_pair_exchange_rate_endpoint_not_found PASSED [ 72%]
tests/test_recommendations.py::test_get_pair_exchange_rate_endpoint_service_exception PASSED [ 72%]
tests/test_recommendations.py::test_convert_currency_success PASSED      [ 73%]
tests/test_recommendations.py::test_convert_currency_error PASSED        [ 73%]
tests/test_recommendations.py::test_get_cultural_insights_success PASSED [ 73%]
tests/test_recommendations.py::test_get_cultural_insights_cache PASSED   [ 73%]
tests/test_recommendations.py::test_get_cultural_insights_error PASSED   [ 74%]
tests/test_recommendations.py::test_get_style_recommendations_success PASSED [ 74%]
tests/test_recommendations.py::test_get_style_recommendations_error PASSED [ 74%]
tests/test_recommendations.py::test_process_cultural_data PASSED         [ 74%]
tests/test_recommendations.py::test_process_style_data PASSED            [ 75%]
tests/test_recommendations.py::test_get_fallback_cultural_data PASSED    [ 75%]
tests/test_recommendations.py::test_get_fallback_style_data PASSED       [ 75%]
tests/test_security.py::test_verify_jwt_token_valid PASSED               [ 75%]
tests/test_security.py::test_verify_jwt_token_missing_user_id PASSED     [ 76%]
tests/test_security.py::test_verify_jwt_token_jwt_error PASSED           [ 76%]
tests/test_security.py::test_verify_jwt_token_value_error PASSED         [ 76%]
tests/test_security.py::test_verify_jwt_token_key_error PASSED           [ 76%]
tests/test_security.py::test_get_user_by_id_success PASSED               [ 77%]
tests/test_security.py::test_get_user_by_id_no_user PASSED               [ 77%]
tests/test_security.py::test_get_user_by_id_value_error PASSED           [ 77%]
tests/test_security.py::test_get_user_by_id_key_error PASSED             [ 77%]
tests/test_security.py::test_get_user_by_id_attribute_error PASSED       [ 78%]
tests/test_security.py::test_revoke_token_success PASSED                 [ 78%]
tests/test_security.py::test_revoke_token_value_error PASSED             [ 78%]
tests/test_security.py::test_create_access_token PASSED                  [ 78%]
tests/test_security.py::test_verify_token_wrapper PASSED                 [ 79%]
tests/test_security.py::test_verify_token_wrapper_none PASSED            [ 79%]
tests/test_security.py::test_verify_jwt_token_with_default_is_active PASSED [ 79%]
tests/test_security.py::test_verify_jwt_token_with_false_is_active PASSED [ 79%]
tests/test_supabase_cache.py::test_get_weather_cache_success PASSED      [ 80%]
tests/test_supabase_cache.py::test_get_weather_cache_expired PASSED      [ 80%]
tests/test_supabase_cache.py::test_get_weather_cache_not_found PASSED    [ 80%]
tests/test_supabase_cache.py::test_set_weather_cache_success PASSED      [ 80%]
tests/test_supabase_cache.py::test_set_weather_cache_error PASSED        [ 81%]
tests/test_supabase_cache.py::test_get_cultural_cache_success PASSED     [ 81%]
tests/test_supabase_cache.py::test_get_cultural_cache_expired PASSED     [ 81%]
tests/test_supabase_cache.py::test_set_cultural_cache_success PASSED     [ 81%]
tests/test_supabase_cache.py::test_get_currency_cache_success PASSED     [ 82%]
tests/test_supabase_cache.py::test_get_currency_cache_empty PASSED       [ 82%]
tests/test_supabase_cache.py::test_set_currency_cache_success PASSED     [ 82%]
tests/test_supabase_cache.py::test_is_expired_future PASSED              [ 82%]
tests/test_supabase_cache.py::test_is_expired_past PASSED                [ 83%]
tests/test_supabase_cache.py::test_is_expired_invalid_format PASSED      [ 83%]
tests/test_supabase_cache.py::test_is_expired_with_z_suffix PASSED       [ 83%]
tests/test_supabase_cache.py::test_get_weather_cache_no_expires_at PASSED [ 83%]
tests/test_supabase_cache.py::test_get_cultural_cache_error PASSED       [ 84%]
tests/test_supabase_cache.py::test_set_cultural_cache_error PASSED       [ 84%]
tests/test_supabase_cache.py::test_get_currency_cache_error PASSED       [ 84%]
tests/test_supabase_cache.py::test_set_currency_cache_error PASSED       [ 84%]
tests/test_user_api.py::TestUserEndpoints::test_get_current_user_profile_success PASSED [ 85%]
tests/test_user_api.py::TestUserEndpoints::test_get_current_user_profile_error PASSED [ 85%]
tests/test_user_api.py::TestUserEndpoints::test_get_current_user_profile_generic_exception PASSED [ 85%]
tests/test_user_api.py::TestUserEndpoints::test_get_user_preferences_success PASSED [ 86%]
tests/test_user_api.py::TestUserEndpoints::test_get_user_preferences_error PASSED [ 86%]
tests/test_user_api.py::TestUserEndpoints::test_get_user_preferences_generic_exception PASSED [ 86%]
tests/test_user_api.py::TestUserEndpoints::test_update_user_preferences_success PASSED [ 86%]
tests/test_user_api.py::TestUserEndpoints::test_update_user_preferences_endpoint_generic_exception PASSED [ 87%]
tests/test_user_api.py::TestUserEndpoints::test_update_user_preferences_error PASSED [ 87%]
tests/test_user_api.py::TestUserEndpoints::test_update_user_preferences_exception PASSED [ 87%]
tests/test_user_api.py::TestUserEndpoints::test_user_endpoints_no_auth PASSED [ 87%]
tests/test_user_api.py::TestUserEndpoints::test_update_user_preferences_invalid_data PASSED [ 88%]
tests/test_user_api.py::TestUserEndpoints::test_save_destination_success PASSED [ 88%]
tests/test_user_api.py::TestUserEndpoints::test_save_destination_no_auth PASSED [ 88%]
tests/test_user_api.py::TestUserEndpoints::test_save_destination_endpoint_generic_exception PASSED [ 88%]
tests/test_user_api.py::TestUserEndpoints::test_save_destination_error PASSED [ 89%]
tests/test_user_api.py::TestUserEndpoints::test_save_destination_exception PASSED [ 89%]
tests/test_user_api.py::TestUserEndpoints::test_save_destination_invalid PASSED [ 89%]
tests/test_user_api.py::TestUserEndpoints::test_update_current_user_profile_success PASSED [ 89%]
tests/test_user_api.py::TestUserEndpoints::test_update_current_user_profile_not_found PASSED [ 90%]
tests/test_user_api.py::TestUserEndpoints::test_update_current_user_profile_unauthenticated PASSED [ 90%]
tests/test_user_models.py::test_user_profile_creation PASSED             [ 90%]
tests/test_user_models.py::test_user_profile_email_validation PASSED     [ 90%]
tests/test_user_models.py::test_user_preferences_defaults PASSED         [ 91%]
tests/test_user_models.py::test_user_auth_token_defaults PASSED          [ 91%]
tests/test_user_models.py::test_user_activity_creation PASSED            [ 91%]
tests/test_user_models.py::test_user_session_defaults PASSED             [ 91%]
tests/test_user_models.py::test_user_feedback_rating_bounds PASSED       [ 92%]
tests/test_user_models.py::test_user_usage_stats_defaults PASSED         [ 92%]
tests/test_user_session_management.py::TestUserSessionManagement::test_create_session_success PASSED [ 92%]
tests/test_user_session_management.py::TestUserSessionManagement::test_create_session_no_auth PASSED [ 92%]
tests/test_user_session_management.py::TestUserSessionManagement::test_create_session_error PASSED [ 93%]
tests/test_user_session_management.py::TestUserSessionManagement::test_create_session_invalid PASSED [ 93%]
tests/test_user_session_management.py::TestUserSessionManagement::test_create_session_missing_conversation_id PASSED [ 93%]
tests/test_user_utils.py::test_extract_user_profile_with_dict_metadata PASSED [ 93%]
tests/test_user_utils.py::test_extract_user_profile_with_object_metadata PASSED [ 94%]
tests/test_user_utils.py::test_extract_user_profile_with_no_metadata PASSED [ 94%]
tests/test_user_utils.py::test_extract_user_profile_with_missing_attributes PASSED [ 94%]
tests/test_user_utils.py::test_extract_user_profile_with_none_user PASSED [ 94%]
tests/test_user_utils.py::test_custom_http_exception_handler_non_http_exception PASSED [ 95%]
tests/test_weather_service.py::test_get_weather_data_cache_hit PASSED    [ 95%]
tests/test_weather_service.py::test_get_weather_data_cache_miss_success PASSED [ 95%]
tests/test_weather_service.py::test_get_weather_data_api_error PASSED    [ 95%]
tests/test_weather_service.py::test__get_current_weather_success PASSED  [ 96%]
tests/test_weather_service.py::test__get_current_weather_error PASSED    [ 96%]
tests/test_weather_service.py::test__get_forecast_api_error PASSED       [ 96%]
tests/test_weather_service.py::test__get_forecast_empty_data PASSED      [ 96%]
tests/test_weather_service.py::test__get_forecast_success_with_data PASSED [ 97%]
tests/test_weather_service.py::test__calculate_precipitation_chance PASSED [ 97%]
tests/test_weather_service.py::test_get_lat_lon_for_city_success PASSED  [ 97%]
tests/test_weather_service.py::test_get_lat_lon_for_city_with_state_country PASSED [ 97%]
tests/test_weather_service.py::test_get_lat_lon_for_city_empty_response PASSED [ 98%]
tests/test_weather_service.py::test_get_lat_lon_for_city_api_error PASSED [ 98%]
tests/test_weather_service.py::test_get_weather_data_geocoding_failure PASSED [ 98%]
tests/test_weather_service.py::test_get_weather_data_current_weather_failure PASSED [ 98%]
tests/test_weather_service.py::test_get_weather_data_service_exception PASSED [ 99%]
tests/test_weather_service.py::test__get_current_weather_api_error PASSED [ 99%]
tests/test_weather_service.py::test__get_current_weather_missing_visibility PASSED [ 99%]
tests/test_weather_service.py::test_get_weather_data_with_state_country PASSED [100%]

=============================== warnings summary ===============================
tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_success
tests/test_orchestrator.py::test_generate_travel_recommendations_exception_handling_alternative
  /opt/hostedtoolcache/Python/3.13.5/x64/lib/python3.13/site-packages/supabase/_sync/client.py:303: DeprecationWarning: The 'timeout' parameter is deprecated. Please configure it in the http client instead.
    return SyncPostgrestClient(

tests/test_chat.py::TestChatEndpoints::test_chat_endpoint_success
tests/test_orchestrator.py::test_generate_travel_recommendations_exception_handling_alternative
  /opt/hostedtoolcache/Python/3.13.5/x64/lib/python3.13/site-packages/supabase/_sync/client.py:303: DeprecationWarning: The 'verify' parameter is deprecated. Please configure it in the http client instead.
    return SyncPostgrestClient(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
- generated xml file: /home/runner/work/travelstyle/travelstyle/backend/reports/pytest-results.xml -
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.13.5-final-0 ________________

Name                                          Stmts   Miss  Cover
-----------------------------------------------------------------
app/__init__.py                                   0      0   100%
app/api/__init__.py                               0      0   100%
app/api/deps.py                                  22      0   100%
app/api/v1/__init__.py                            0      0   100%
app/api/v1/auth.py                              118      3    97%
app/api/v1/chat.py                               91      5    95%
app/api/v1/currency.py                           54      0   100%
app/api/v1/recommendations.py                    78      0   100%
app/api/v1/user.py                               76      5    93%
app/core/__init__.py                              0      0   100%
app/core/config.py                               26      0   100%
app/core/security.py                             45      3    93%
app/main.py                                      47     12    74%
app/models/__init__.py                            0      0   100%
app/models/auth.py                               46      0   100%
app/models/responses.py                          23      0   100%
app/models/travel.py                            113      0   100%
app/models/user.py                               96      0   100%
app/services/__init__.py                          0      0   100%
app/services/auth_service.py                    145      3    98%
app/services/currency_conversion_service.py      75      7    91%
app/services/currency_service.py                 69      0   100%
app/services/database_helpers.py                117      0   100%
app/services/openai_service.py                   67      3    96%
app/services/orchestrator.py                     82      2    98%
app/services/qloo_service.py                     57      9    84%
app/services/supabase_cache.py                   76      0   100%
app/services/weather_service.py                 110      0   100%
app/utils/__init__.py                             0      0   100%
app/utils/error_handlers.py                       9      0   100%
app/utils/rate_limiter.py                        51      0   100%
app/utils/user_utils.py                          18      0   100%
-----------------------------------------------------------------
TOTAL                                          1711     52    97%
Coverage XML written to file reports/pytest-coverage.xml
Coverage JSON written to file reports/pytest-coverage.json
======================= 393 passed, 4 warnings in 23.53s =======================
